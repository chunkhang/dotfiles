[user]
  name = Marcus Mu
  email = chunkhang@gmail.com

[core]
  editor = nvim
  excludesfile = ~/.gitignore_global

[commit]
  verbose = true

[pull]
  rebase = true

[diff]
  tool = vimdiff

[difftool]
  prompt = true
  trustExitCode = true

[merge]
  tool = nvim

[mergetool]
  prompt = false
  keepBackup = false

[mergetool "nvim"]
  cmd = \
    nvim -R "$MERGED" "$BASE" "$LOCAL" "$REMOTE" \
    -c 'setlocal noreadonly splitbelow' \
    -c 'tab sbuffer 2 | sbuffer 3 | windo diffthis' \
    -c 'tab sbuffer 2 | sbuffer 4 | windo diffthis' \
    -c 'tabfirst'
  trustExitCode = true

[alias]
  discard = checkout -- *
  drop = reset --hard @{u}
  fix-gita = \
    !git commit --amend --no-edit --quiet && \
    git reset --hard @{u}
  housekeeping = \
    !git branch --merged | grep -vE 'develop|master|staging' | xargs git branch -d && \
    git fetch --prune && \
    git reflog expire --expire-unreachable=now --all && \
    git gc --prune=now --aggressive
  pr = \
    !host="bitbucket.org" && \
    repo=$(git ls-remote --get-url | cut -f 2 -d "@" | cut -f 2 -d ":" | cut -f 1 -d ".") && \
    branch=$(git symbolic-ref --short HEAD) && \
    open "https://${host}/${repo}/pull-requests/new?source=${branch}"
  unstage = reset HEAD *
