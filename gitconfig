[user]
  name = Marcus Mu
  email = chunkhang@gmail.com

[core]
  editor = nvim
  excludesfile = ~/.gitignore_global

[commit]
  verbose = true

[push]
  followTags = true

[pull]
  rebase = true

[diff]
  tool = nvim

[difftool]
  prompt = true
  trustExitCode = true

[difftool "nvim"]
  cmd = \
    nvim -d "$LOCAL" "$REMOTE" \
    -c 'wincmd l'

[merge]
  tool = nvim

[mergetool]
  prompt = false
  keepBackup = false

[mergetool "nvim"]
  cmd = \
    nvim -R "$MERGED" "$BASE" "$LOCAL" "$REMOTE" \
    -c 'setlocal noreadonly splitbelow' \
    -c 'tab sbuffer 2 | sbuffer 3 | windo diffthis' \
    -c 'tab sbuffer 2 | sbuffer 4 | windo diffthis' \
    -c 'tabfirst'
  trustExitCode = true

[alias]

  unstage = reset HEAD *

  discard = checkout -- *

  drop = reset --hard @{u}

  tidy = "!f() { \
    git checkout master ;\
    git pull ;\
    git fetch --prune ;\
    git branch --verbose | grep '\\[gone\\]' | awk '{print $1}' | xargs git branch --delete --force ;\
    git reflog expire --expire-unreachable=now --all ;\
    git gc --prune=now --aggressive ;\
  }; f"

  pr = "!f() { \
    repo=$(git ls-remote --get-url | cut -d : -f 2 | cut -d . -f 1) ;\
    branch=$(git symbolic-ref --short HEAD) ;\
    url="https://bitbucket.org/${repo}/pull-requests/new?source=${branch}" ;\
    echo "$url" ;\
    open "$url" ;\
  }; f"

  monday = "!f() { \
    git checkout --quiet @ ;\
    git fetch origin master:master develop:develop ;\
    git checkout --quiet develop ;\
  }; f"
